# Руководство по тестированию автоматического обновления времени в билетах квестов

## Команды для тестирования

### 1. `/check_time_status`
Показывает текущий статус билета квеста в руке:
- Состояние билета
- Время принятия (если инициализировано)
- Прошедшее время
- Оставшееся время

### 2. `/test_auto_time`
Сбрасывает билет в состояние "Доступен" для тестирования автоматической инициализации времени.

### 3. `/test_time_update [минуты]`
Устанавливает время принятия квеста назад на указанное количество минут для тестирования отображения времени.

### 4. `/reset_all_ticket_times`
Сбрасывает время всех билетов квестов в инвентаре игрока в исходное состояние.

## Пошаговое тестирование

### Тест 1: Автоматическая инициализация времени
1. Возьмите билет квеста в руку
2. Выполните `/test_auto_time` - билет будет сброшен в состояние "Доступен"
3. Выполните `/check_time_status` - должно показать "Время не инициализировано"
4. Наведите курсор на билет в инвентаре (откройте тултип)
5. Выполните `/check_time_status` снова - время должно быть инициализировано

### Тест 2: Обновление времени в реальном времени
1. После инициализации времени (Тест 1)
2. Наведите курсор на билет несколько раз с интервалом в несколько секунд
3. Время в тултипе должно уменьшаться с каждым обновлением
4. Секунды должны отображаться и обновляться

### Тест 3: Тестирование с заданным временем
1. Выполните `/test_time_update 5` - установит время принятия 5 минут назад
2. Наведите курсор на билет
3. Время должно показывать оставшееся время с учетом прошедших 5 минут
4. Время должно продолжать обновляться в реальном времени

### Тест 4: Проверка изоляции от доски объявлений
1. Выполните `/reset_all_ticket_times` для сброса всех билетов
2. Откройте доску объявлений
3. Наведите курсор на билеты на доске - они должны оставаться в состоянии "Доступен"
4. Закройте доску объявлений
5. Наведите курсор на билеты в инвентаре - время должно инициализироваться только для них

### Тест 5: Истечение времени
1. Выполните `/test_time_update [время больше лимита квеста]`
2. Наведите курсор на билет
3. Должно отображаться "ВРЕМЯ ИСТЕКЛО!" красным цветом
4. Состояние билета должно измениться на "Провален"

## Ожидаемое поведение

### Цветовая схема времени:
- **Зеленый**: полное время при первой инициализации
- **Голубой**: более 15 минут осталось
- **Желтый**: менее 15 минут осталось
- **Красный**: менее 5 минут осталось + "(СРОЧНО!)"
- **Темно-красный**: время истекло

### Формат отображения времени:
- Менее минуты: "30с"
- Менее часа: "45м 30с"
- Более часа: "1ч 45м 30с"

### Автоматические переходы состояний:
- "Доступен" → "Принят" (при первом отображении тултипа)
- "Принят"/"В процессе" → "Провален" (при истечении времени)

## Устранение неполадок

### Если время не инициализируется:
1. Убедитесь, что у квеста есть лимит времени (больше 0)
2. Проверьте, что билет в состоянии "Доступен"
3. Попробуйте закрыть и открыть инвентарь
4. Используйте `/test_auto_time` для принудительного сброса

### Если время не обновляется:
1. Проверьте, что клиентские миксины загружены корректно
2. Убедитесь, что билет в активном состоянии
3. Попробуйте переложить билет в другой слот инвентаря

### Если отображается неправильное время:
1. Используйте `/check_time_status` для проверки внутреннего состояния
2. Сравните время в команде с временем в тултипе
3. Проверьте системное время сервера и клиента