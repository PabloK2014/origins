# Исправления системы квестов

## Проблемы, которые были исправлены:

### 1. Дублирование методов в QuestTicketItem.java
- **Проблема**: Дублированные методы `addProgressTooltip` и `addTimeTooltip` вызывали ошибки компиляции
- **Решение**: Удалены дублированные методы, оставлены более полные версии

### 2. Отображение редкости квестов
- **Проблема**: Редкость отображалась как "quest.rarity.common" вместо нормального текста
- **Решение**: 
  - Добавлены переводы в `ru_ru.json`
  - Исправлена логика отображения редкости с null-проверками

### 3. Ошибки с null objective
- **Проблема**: `Cannot invoke "QuestObjective.isCompleted()" because "objective" is null`
- **Решение**: Добавлены проверки на null во всех методах работы с objectives

### 4. Отслеживание прогресса квестов
- **Проблема**: Прогресс квестов не обновлялся (оставался 0/5)
- **Решение**:
  - Исправлен миксин `QuestCraftingMixin` - убран несуществующий метод `onSlotClick`
  - Добавлен новый миксин `CraftingResultSlotMixin` для отслеживания крафта
  - Исправлена логика сравнения ID предметов в `QuestProgressTracker`
  - Добавлено логирование для отладки

### 5. Инициализация системы
- **Проблема**: Обработчики событий не инициализировались правильно
- **Решение**: 
  - Добавлена инициализация `QuestEventHandlers.initialize()` в `Origins.java`
  - Добавлен обработчик тиков сервера для периодического обновления прогресса

## Новые файлы:

1. **CraftingResultSlotMixin.java** - Миксин для отслеживания взятия предметов из слота результата крафта
2. **TestQuestCommand.java** - Команда для тестирования системы квестов
3. **test_quests.json** - Тестовые квесты для проверки системы

## Команды для тестирования:

- `/testquest give` - Выдает тестовый квест на создание 5 хлеба
- `/testquest progress` - Тестирует отслеживание прогресса крафта

## Как тестировать:

1. Запустите игру
2. Выполните `/testquest give` чтобы получить тестовый билет квеста
3. Создайте хлеб в верстаке
4. Проверьте, что прогресс обновляется в tooltip билета
5. Убедитесь, что редкость отображается правильно

## Логирование:

Система теперь логирует:
- Действия игроков (крафт, сбор, убийство)
- Обновления прогресса квестов
- Ошибки при обработке квестов
- Совпадения целей квестов

Логи можно найти в консоли сервера с префиксом `[Origins]`.