# Исправление отображения времени в билетах квестов

## Проблема
Время в тултипе билета квеста не обновлялось в реальном времени и отображалось только в секции "Прогресс" для активных квестов. Секунды не отображались, что затрудняло отслеживание оставшегося времени. Основная проблема заключалась в том, что:
1. Тултипы не обновлялись автоматически на клиенте
2. Время начинало отсчитываться только после принятия квеста командой или через доску объявлений
3. При простом взятии билета в руки время не инициализировалось

## Решение

### 1. Улучшено отображение времени
- **Для неактивных квестов**: показывается лимит времени ("Время: 1ч 0м")
- **Для активных квестов**: показывается оставшееся время с секундами ("Время: 54м 32с")

### 2. Добавлены секунды в отображение времени
- Для квестов с оставшимся временем менее 5 минут: показывается в формате "5м 32с (СРОЧНО!)" (красный цвет)
- Для квестов с оставшимся временем менее 15 минут: показывается в формате "14м 32с" (желтый цвет)
- Для квестов с оставшимся временем менее часа: показывается в формате "45м 32с" (голубой цвет)
- Для квестов с оставшимся временем более часа: показывается в формате "1ч 45м 32с" (голубой цвет)

### 3. Реализована клиентская система принудительного обновления тултипов
- **QuestTicketClientUpdater**: обновляет данные билетов каждые 5 тиков (4 раза в секунду)
- **QuestTicketTooltipMixin**: принудительно обновляет время при каждом отображении тултипа
- **ItemStackTooltipMixin**: обновляет временные данные перед генерацией тултипа

### 4. Улучшена система обновления времени
- Время обновляется каждую секунду (вместо каждой минуты)
- Время принудительно обновляется при каждом отображении тултипа
- Более точная проверка истечения времени (в секундах вместо минут)
- Клиентская синхронизация времени для плавного отображения

### 5. Автоматическая инициализация времени
- Время автоматически начинает отсчитываться при первом отображении тултипа билета
- Билеты автоматически переходят из состояния "Доступен" в "Принят" при взятии в руки
- Не требуется дополнительных действий для начала отсчета времени

### 6. Перенесено отображение времени в основной тултип
- Время теперь отображается в основной части тултипа (рядом с классом и редкостью)
- Убрано дублирование времени в секции "Прогресс"
- Время видно для всех квестов, не только для активных

## Изменения в коде

### QuestTicketItem.java
- Улучшен метод `addTimeTooltip()` с поддержкой секунд
- Обновлен метод `updateTimeForActiveQuest()` для работы с секундами
- Убрано дублирование времени в секции прогресса

### QuestItem.java
- Добавлен новый метод `getQuestTimeInfo()` для умного отображения времени
- Метод автоматически выбирает между лимитом времени и оставшимся временем

### QuestTicketTimeUpdater.java
- Изменен интервал обновления с 60 секунд на 1 секунду
- Улучшена точность проверки истечения времени

### TestTimeUpdateCommand.java
- Добавлена тестовая команда `/test_time_update [минуты]` для проверки работы системы времени

### TestAutoTimeCommand.java
- Добавлена команда `/test_auto_time` для тестирования автоматической инициализации времени

### ResetAllTicketTimesCommand.java
- Добавлена команда `/reset_all_ticket_times` для сброса времени всех билетов в инвентаре

### InventoryHelper.java
- Утилитарный класс для проверки контекста отображения тултипов
- Предотвращает инициализацию времени для билетов на доске объявлений

## Использование

### Тестирование автоматической инициализации
1. Выполните команду `/test_auto_time` держа билет квеста в руке
2. Билет будет сброшен в состояние "Доступен"
3. Наведите курсор на билет - время должно автоматически начать отсчет

### Тестирование с заданным временем
1. Возьмите билет квеста в руку
2. Выполните команду `/test_time_update 5` (установит время принятия 5 минут назад)
3. Наведите курсор на билет - время должно отображаться с секундами в основном тултипе

### Обычное использование
- Время автоматически начинает отсчитываться при первом наведении на билет
- Время автоматически обновляется каждую секунду
- При наведении на билет квеста время всегда актуальное
- Цвет времени меняется в зависимости от срочности:
  - Зеленый: полное время (при первой инициализации)
  - Голубой: более 15 минут
  - Желтый: менее 15 минут  
  - Красный: менее 5 минут

## Результат
Теперь игроки могут точно отслеживать оставшееся время выполнения квестов с точностью до секунды. Время автоматически начинает отсчитываться только для билетов в инвентаре игрока при наведении курсора. Билеты на доске объявлений остаются в исходном состоянии и не инициализируют время автоматически. Время отображается в удобном месте основного тултипа и обновляется в реальном времени.